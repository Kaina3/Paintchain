# Phase 05: 描画キャンバス

## 概要
配られたお題（テキスト）を見て、絵を描いて提出する。

## ゴール
- お題テキストを表示し、それを絵で表現する。
- シンプルなキャンバス（色/太さ/消しゴム/Undo）で描画。
- 描画を PNG/JPEG で提出、サーバ経由で S3 保存。
- 制限時間 90 秒、タイムアウトで白紙自動提出。

---

## 成果物
- 描画キャンバス UI
- 描画ツール（ペン色/太さ/消しゴム/Undo/クリア）
- 画像提出 WS / HTTP
- 画像ストレージ連携

---

## 機能要件

### サーバ側
| エンドポイント / イベント | 説明 |
|--------------------------|------|
| `WS: receive_prompt` | 描くべきお題テキストを受信 |
| `POST /entries/drawing` | 画像データ（Base64 or multipart）をアップロード |
| `WS: submit_drawing` | 画像 URL を Entry として登録 |
| `WS: submission_received` | 提出状況ブロードキャスト |
| `WS: phase_complete` | 全員提出 or タイムアウト |

### フロント側
| 機能 | 説明 |
|------|------|
| お題表示 | 「○○を描いてください」 |
| キャンバス | Canvas API でフリーハンド描画 |
| ツールバー | 色選択、太さ選択、消しゴム、Undo、クリア |
| 提出ボタン | キャンバスを PNG 化して送信 |
| タイマー | 残り 90 秒カウントダウン |

---

## キャンバス仕様

| 項目 | 値 |
|------|-----|
| 解像度 | 800 x 600 px（固定） |
| 背景色 | 白 |
| ペン色 | 黒, 赤, 青, 緑, 黄, オレンジ, 紫, 茶 (8色) |
| ペン太さ | 細(2px), 中(5px), 太(10px) |
| 消しゴム | 白で描画 or clearRect |
| Undo | 直前 1 ストローク戻し（履歴スナップショット） |
| クリア | 全消去（確認ダイアログ） |
| 出力形式 | PNG（≤200KB 目安、品質調整で圧縮） |

---

## タスク

### サーバ
- [ ] `POST /entries/drawing` — 画像受信 → S3 アップロード → URL 返却
- [ ] S3ImageRepository 実装（Supabase Storage）
- [x] `submit_drawing` ハンドラ — Entry 追加
- [x] タイムアウト時の白紙画像生成＆自動提出
- [ ] 画像サイズ上限チェック（200KB）

### フロント
- [x] Canvas コンポーネント
- [x] 描画ロジック（mousedown/move/up, touch 対応）
- [x] ツールバー UI
- [x] 色選択（パレット）
- [x] 太さ選択（3段階）
- [x] 消しゴムモード
- [x] Undo 機能（ストローク履歴）
- [x] クリアボタン
- [x] 提出処理（canvas.toDataURL → fetch POST）
- [x] タイマー表示
- [x] お題テキスト表示

---

## モバイル対応
- [x] タッチイベント対応
- [x] 2本指スクロール/ズーム無効化（`touch-action: none`）
- [x] キャンバスサイズをビューポートに合わせてスケール

---

## 受け入れ条件
- [x] お題が画面上部に表示される
- [x] 8色のペンで描画できる
- [x] 太さを変更できる
- [x] 消しゴムで消せる
- [x] Undo で直前に戻せる
- [x] 提出ボタンで画像がアップロードされる
- [x] 90秒でタイムアウト、白紙が自動提出される
- [x] スマホでも描画できる

---

## 依存関係
- Phase 04 完了（お題入力 → Chain 初期化済み）
- S3 / Supabase Storage セットアップ

## 次フェーズへの引き継ぎ
- 画像アップロードの仕組み
- Entry に imageUrl 保存
