# Phase 07: ターンローテーション

## 概要
「お題→絵→回答→絵→回答…」を人数分繰り返すローテーションを実装する。

## ゴール
- チェーンが次のプレイヤーへ回る仕組み。
- 描画フェーズと回答フェーズを交互に実行。
- 全ターン完了後、結果発表フェーズへ遷移。

---

## 成果物
- ターン管理ロジック（サーバ）
- フェーズ切り替え通知
- チェーン配布ロジック

---

## ローテーション仕様

### 例: 4人プレイ
```
ターン0: 全員がお題入力（各自の Chain に Entry[0] = text）
ターン1: A→B, B→C, C→D, D→A のチェーンが配布、絵を描く
ターン2: 回ってきた絵に対してテキスト回答
ターン3: 回ってきたテキストに対して絵を描く
... (人数 - 1 ターン)
最終: 結果発表
```

- ターン数 = プレイヤー数（お題入力含む）
- 奇数ターン = 描画、偶数ターン = 回答（ターン0除く）

---

## 機能要件

### サーバ側
| 機能 | 説明 |
|------|------|
| ターン管理 | Room.currentTurn を管理 |
| チェーン配布 | 各ターンで「誰が誰のチェーンを受け取るか」を決定 |
| フェーズ判定 | ターン番号から描画/回答を判定 |
| 全ターン完了判定 | 最終ターン完了 → 結果発表へ |

### データ構造
```ts
interface Room {
  // ...existing
  currentTurn: number;
  totalTurns: number;  // = players.length
}

// チェーン配布マップ（各ターンで計算）
// playerId -> chainId
```

---

## タスク

### サーバ
- [x] Room に currentTurn, totalTurns 追加
- [x] ターン開始時のチェーン配布ロジック
  - プレイヤーをリング状に並べ、ターンごとに 1 つずらす
- [x] フェーズ判定関数（描画 or 回答）
- [x] `phase_changed` にフェーズ種別を含める
- [x] 全ターン完了チェック → 結果発表フェーズへ

### フロント
- [x] 現在のターン表示（「ターン 3/5」など）
- [x] フェーズに応じた画面切り替え（描画 or 回答）

---

## 受け入れ条件
- [x] 描画→回答→描画→回答 と交互にフェーズが切り替わる
- [x] 各ターンで異なるチェーンが配られる
- [x] 自分が書いたお題は自分に戻ってこない（最終ターンまで）
- [x] 全ターン完了後、結果発表へ遷移

---

## 依存関係
- Phase 05, 06 完了（描画/回答の各フェーズ実装済み）

## 次フェーズへの引き継ぎ
- 完成した Chain データ（全 Entry 揃い）
