# Phase 09: タイマー同期

## 概要
全プレイヤーで同期したタイマーを実装し、公平なゲーム進行を保証する。

## ゴール
- サーバ主導のタイマーで全員の残り時間が一致。
- タイムアウト時の自動提出が確実に動作。
- ネットワーク遅延を考慮した補正。

---

## 成果物
- サーバ側タイマー管理
- クライアント側タイマー表示（サーバ同期）
- タイムアウト処理

---

## 機能要件

### サーバ側
| 機能 | 説明 |
|------|------|
| フェーズ開始時刻記録 | 各フェーズ開始時に timestamp を記録 |
| 残り時間計算 | deadline - now で計算 |
| タイマー通知 | `timer_sync` イベントで残り時間を定期送信 |
| タイムアウト処理 | deadline 到達時に未提出者を自動提出 |

### フロント側
| 機能 | 説明 |
|------|------|
| タイマー表示 | サーバから受け取った残り時間を表示 |
| ローカル補間 | サーバ通知間はクライアント側でカウントダウン |
| 警告表示 | 残り 10 秒で色変更/アニメーション |

---

## 同期仕様

```
サーバ: フェーズ開始
  ↓
サーバ → クライアント: phase_started { deadline: ISO8601 }
  ↓
クライアント: deadline - Date.now() で残り時間計算
  ↓
サーバ → クライアント: timer_sync { remaining: 秒 } (10秒ごと)
  ↓
クライアント: サーバ値で補正
  ↓
サーバ: deadline 到達 → 自動提出処理
```

---

## タスク

### サーバ
- [x] フェーズ開始時に deadline を設定
- [x] `phase_started` に deadline を含める
- [x] `timer_sync` を 10 秒ごとにブロードキャスト
- [x] タイムアウト処理（setTimeout）
- [x] 未提出者の自動提出（白紙/空文字）

### フロント
- [x] タイマーコンポーネント
- [x] deadline からのカウントダウン計算
- [x] `timer_sync` で補正
- [x] 残り時間のフォーマット（MM:SS）
- [x] 残り 10 秒以下で警告スタイル

---

## 受け入れ条件
- [x] 全プレイヤーのタイマーが ±1 秒以内で同期
- [x] タイムアウト時に全員が同時に次フェーズへ遷移
- [x] ネットワーク遅延があってもゲーム進行が止まらない

---

## 依存関係
- Phase 04, 05, 06 の各フェーズで使用

## 次フェーズへの引き継ぎ
- 共通タイマーユーティリティ
